{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConcordiaBook</title>
    <link rel="icon" type="image/png" href="{% static 'images/concordia-logo.png' %}">
    {% load bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
</head>

<body>
    <header class="bg-body-tertiary py-2">
        <nav class="container-fluid d-flex flex-column flex-md-row align-items-center justify-content-between gap-5">
            <a class="col btn btn-outline-light d-flex flex-row align-items-center mb-2 mb-md-0" style="gap: 12px;"
                href="/">
                <img src="{% static 'images/concordia-logo.png' %}" alt="Concordia logo" style="height:48px;">
                <h1 class="m-0" style="color: black; font-size: 1.5rem;">ConcordiaBook Market</h1>
            </a>

            {% include "textbooks/search_form.html" %}

            <div class="mb-0 col text-center text-md-start py-4 py-md-0 d-flex align-items-center gap-3">
                Hello, {{ username }}
                <a class="btn btn-outline-dark" href="{% url 'logout' %}">Logout</a>
            </div>

        </nav>
        <hr style="border: 1px solid #ccc; width: 100%;">
    </header>

    <div class="main-container d-flex flex-column flex-md-row  px-2">
        <div class="col-md-2 d-flex flex-column align-items-center">
            {% include "textbooks/add_form.html" %}
        </div>

        <div class="col-md-6 pt-5 pt-md-0">
            {% include "textbooks/list.html" %}
        </div>
    </div>

    <div id="liveAlertPlaceholder" class="position-fixed top-0 end-0 p-3" style="z-index: 1060;"></div>

    <footer style="text-align: center; margin-top: 20px; color: grey; height: 30vh;" class="pt-5">
        <p>&copy; 2025 Created by Yuelin Wen@Concordia Meng Electrial Computer Eng. All rights reserved.</p>
    </footer>

</body>

</html>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
        const popoverList = [...popoverTriggerList].map(el => new bootstrap.Popover(el))
    })

    document.addEventListener('DOMContentLoaded', function () {
        try {
            var input = document.getElementById('textbooks-search-input');
            if (input && input.value && input.value.trim() !== '') {
                setTimeout(function () { input.value = ''; }, 50);
            }
        } catch (e) {
            console.error('Search-clear script error', e);
        }
    });

    const alertPlaceholder = document.getElementById('liveAlertPlaceholder')

    const appendAlert = (message, type = 'success') => {
        const wrapper = document.createElement('div')
        wrapper.innerHTML = [
            `<div class="alert alert-${type} alert-dismissible fade show" role="alert">`,
            `   <div>${message}</div>`,
            '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
            '</div>'
        ].join('')

        alertPlaceholder.append(wrapper)
        setTimeout(() => {
            try { bootstrap.Alert.getOrCreateInstance(wrapper.querySelector('.alert')).close(); } catch (e) { wrapper.remove(); }
        }, 2000)
    }

    document.addEventListener('click', function (e) {
        const btn = e.target.closest && e.target.closest('.exchange-btn')
        if (!btn) return
        const title = btn.getAttribute('data-title') || 'the book'
        appendAlert(`Added "${title}" to the exchange queue.`, 'success')
    })
</script>